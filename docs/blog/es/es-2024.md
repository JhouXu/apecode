# ECMAScript 2024

ECMAScript 2024ï¼ˆES15ï¼‰äº 2024 å¹´ 6 æœˆå‘å¸ƒã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. Promise.withResolvers()

`å¼‚æ­¥æ§åˆ¶å¢å¼º`ï¼Œå…è®¸ç›´æ¥åˆ›å»º Promise å¹¶è·å–å…¶ `resolve` å’Œ `reject` å‡½æ•°ï¼Œé€‚ç”¨äºéœ€è¦æ‰‹åŠ¨æ§åˆ¶å¼‚æ­¥ç»“æœçš„åœºæ™¯ã€‚

```javascript
const { promise, resolve } = Promise.withResolvers();
setTimeout(() => resolve("æ“ä½œæˆåŠŸ"), 1000);
await promise; // è¾“å‡ºï¼š"æ“ä½œæˆåŠŸ"
```

### 2. æ•°æ®åˆ†ç»„æ–¹æ³•

`Object.groupBy()` ä¸ `Map.groupBy()`

æŒ‰æ¡ä»¶å¯¹æ•°ç»„å…ƒç´ åˆ†ç»„ï¼Œè¿”å›æ™®é€šå¯¹è±¡æˆ– Map å¯¹è±¡ï¼Œç®€åŒ–æ•°æ®èšåˆé€»è¾‘ã€‚

```javascript
const users = [
  { name: "Alice", role: "admin" },
  { name: "Bob", role: "user" },
];
const grouped = Object.groupBy(users, (user) => user.role);
// è¾“å‡ºï¼š{ admin: [Alice...], user: [Bob...] }
```

åœºæ™¯ï¼šæ•°æ®èšåˆã€åˆ†ç±»ç»Ÿè®¡ã€‚

`æ³¨æ„`ï¼šObject.groupBy è¿”å›æ— åŸå‹çš„å¯¹è±¡ï¼Œæ— æ³•è°ƒç”¨ hasOwnProperty ç­‰æ–¹æ³•ã€‚

### 3. æ­£åˆ™è¡¨è¾¾å¼ `v` æ ‡å¿—

`å¢å¼º Unicode æ”¯æŒ`ï¼Œæ”¯æŒé›†åˆæ“ä½œï¼ˆ`å·®é›† --`ã€`äº¤é›† &&`ï¼‰å’Œå¤šèŠ‚ç‚¹å­—ç¬¦åŒ¹é…ã€‚

```javascript
const re = /[\p{Letter}&&\p{ASCII}]+/v;
re.test("Hello"); // trueï¼ˆä»…åŒ¹é… ASCII å­—æ¯ï¼‰
```

### 4. å­—ç¬¦ä¸²æ ¼å¼æ ¡éªŒä¸ä¿®å¤

æ£€æµ‹å¹¶ä¿®å¤æ— æ•ˆ Unicode å­—ç¬¦ã€‚

- `String.prototype.isWellFormed()`ï¼šæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚
- `String.prototype.toWellFormed()`ï¼šå°†æ— æ•ˆå­—ç¬¦æ›¿æ¢ä¸º ï¿½ï¼ˆU+FFFDï¼‰ã€‚

```javascript
const str = "Hello\uD800World";
str.isWellFormed(); // false
str.toWellFormed(); // "Helloï¿½World"
```

### 5. `ArrayBuffer` åŠ¨æ€è°ƒæ•´ä¸è½¬ç§»

ä¼˜åŒ–äºŒè¿›åˆ¶æ•°æ®å¤„ç†æ€§èƒ½ã€‚ç”¨äºéŸ³è§†é¢‘å¤„ç†ã€WebAssembly äº¤äº’ã€‚

- `resize()`ï¼šåŠ¨æ€è°ƒæ•´ç¼“å†²åŒºå¤§å°ï¼ˆéœ€é¢„å®šä¹‰ `maxByteLength`ï¼‰ã€‚
- `transfer()`ï¼šé›¶æ‹·è´è½¬ç§»æ‰€æœ‰æƒï¼Œæå‡å¤§å†…å­˜æ“ä½œæ•ˆç‡ã€‚

```javascript
const buffer = new ArrayBuffer(8, { maxByteLength: 16 });
buffer.resize(12); // æ‰©å®¹è‡³ 12 å­—èŠ‚
const newBuffer = buffer.transfer(); // åŸ buffer åˆ†ç¦»
```

### 6. Atomics.waitAsync()

`å¼‚æ­¥å…±äº«å†…å­˜ç­‰å¾…`ï¼Œéé˜»å¡ç­‰å¾… `SharedArrayBuffer` çš„å€¼å˜åŒ–ï¼Œé¿å…ä¸»çº¿ç¨‹å†»ç»“ã€‚

```javascript
const sab = new SharedArrayBuffer(1024);
const int32 = new Int32Array(sab);
const { promise } = Atomics.waitAsync(int32, 0, 0);
Atomics.notify(int32, 0); // è§¦å‘è§£å†³
await promise;
```

åœºæ™¯ï¼šå¤šçº¿ç¨‹åä½œï¼ˆWeb Workerï¼‰ã€é«˜æ€§èƒ½è®¡ç®—ã€‚

### 7. é¡¶å±‚ await

å…è®¸åœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ awaitï¼Œç®€åŒ–å¼‚æ­¥åˆå§‹åŒ–é€»è¾‘ã€‚

```javascript
// æ¨¡å—ä¸­ç›´æ¥ä½¿ç”¨
const data = await fetchData();
export default data;
```

### 8. Hashbang è¯­æ³•æ ‡å‡†åŒ–

æ”¯æŒåœ¨è„šæœ¬æ–‡ä»¶é¦–è¡Œä½¿ç”¨ #!/usr/bin/env nodeï¼Œå…¼å®¹ Node.js ç›´æ¥æ‰§è¡Œã€‚

```javascript
#!/usr/bin/env node
console.log("Hello World");
```

## å…¼å®¹æ€§

<BrowserCard  cv="127+" fv="128+" sv="18.0+" ev="127+" nv="21.0+" />

<!--
| Chrome | Firefox | Safari | Edge | Node.js |
| :----: | :-----: | :----: | :--: | :-----: |
|  127+  |  128+   | 18.0+  | 127+ |  21.0+  |
-->

> æ³¨ï¼šå…¼å®¹æ€§æ•°æ®å¯èƒ½éšç€ç‰ˆæœ¬çš„æ›´æ–°è€Œæœ‰æ‰€è°ƒæ•´ï¼Œå»ºè®®å¼€å‘è€…æ ¹æ®é¡¹ç›®çš„å…·ä½“éœ€æ±‚å‚è€ƒæœ€æ–°çš„æµè§ˆå™¨ç‰ˆæœ¬å’Œ Polyfill æ”¯æŒæƒ…å†µã€‚

## æ€»ç»“

ES2024 èšç„¦äº å¼‚æ­¥æ§åˆ¶ã€æ•°æ®å¤„ç† å’Œ å†…å­˜ä¼˜åŒ–ã€‚

**å‚è€ƒæ–‡çŒ®**

[ECMA-262 2024 è§„èŒƒ ğŸ‘‰](https://tc39.es/ecma262/2024/)
