import{_ as s,o as a,c as n,N as l}from"./chunks/framework.c7d469ad.js";const o="/apecode/images/blog/program/20210414112718906.png",t="/apecode/images/blog/program/20210414113812989.png",h=JSON.parse('{"title":"自定义小程序 navigationBar 的高度，以及避免设备系统不同产生不兼容","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"pages/blog/program-navigation-bar-height.md","lastUpdated":1697681558000}'),p={name:"pages/blog/program-navigation-bar-height.md"},e=l('<h1 id="自定义小程序-navigationbar-的高度-以及避免设备系统不同产生不兼容" tabindex="-1">自定义小程序 navigationBar 的高度，以及避免设备系统不同产生不兼容 <a class="header-anchor" href="#自定义小程序-navigationbar-的高度-以及避免设备系统不同产生不兼容" aria-label="Permalink to &quot;自定义小程序 navigationBar 的高度，以及避免设备系统不同产生不兼容&quot;">​</a></h1><h2 id="项目场景" tabindex="-1">项目场景： <a class="header-anchor" href="#项目场景" aria-label="Permalink to &quot;项目场景：&quot;">​</a></h2><p>在小程序中通过 navigationStyle: custom; 属性，自定 navigationBar 的时候。</p><p><img src="'+o+`" alt="在这里插入图片描述"></p><p>自定 navigationBar 实现思路：</p><ul><li>通过 wx.getSystemInfo() 获取到当前设备的状态栏高度（statusBarHeight）。</li><li>然后通过 wx.getMenuButtonBoundingClientRect() 获取到胶囊的高度信息（height）。</li><li>需要注意的是在胶囊和状态栏之间的间距，计算方式是用胶囊的 top 值减去设备状态栏高度即可。</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 大致的计算方式</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 这里之所以乘2，是因为还要算上胶囊底部的距离</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> navigationBar </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> statusBarHeight </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (top </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> statusBarHeight) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="问题描述" tabindex="-1">问题描述： <a class="header-anchor" href="#问题描述" aria-label="Permalink to &quot;问题描述：&quot;">​</a></h2><p>通过上述方式，实现了 navigationBar，但是发现在 iPhone 设备上，却和系统默认的高度不同。（如图所示，前面图层是自动的 navigationBar，后面图层则是系统默认的 navigationBar，可以清晰看出默认的 navigationBar 在 iPhone 设备上会<code>大于</code> 上述计算方式。） <img src="`+t+`" alt="在这里插入图片描述"></p><h2 id="原因分析" tabindex="-1">原因分析： <a class="header-anchor" href="#原因分析" aria-label="Permalink to &quot;原因分析：&quot;">​</a></h2><p>主要的原因还是 iPhone 和 Android 的不兼容。</p><h2 id="解决方案" tabindex="-1">解决方案： <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案：&quot;">​</a></h2><p>经过测试，iPhone 的胶囊底部高度刚好是胶囊顶部到 statusBar 的两倍，所以需要增加一个设备的判断。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> statusBarHeight </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> wx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSystemInfoSync</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 当前设备信息</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> height</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> top </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> wx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getMenuButtonBoundingClientRect</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 胶囊状态信息</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 判断是否为iPhone设备，是：比值为3，否：比值为2</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> isIOSRatio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> model</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">iPhone</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 比值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 自定义标题栏的高度 =</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 状态栏的高度 +</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 状态栏与标题栏之间的缝隙（根据设备不同乘上对应的比值） +</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 胶囊的高度</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> navigationBarHeight </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> statusBarHeight </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (top </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> statusBarHeight) </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> isIOSRatio </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> height)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,14),r=[e];function c(i,y,D,C,A,F){return a(),n("div",null,r)}const d=s(p,[["render",c]]);export{h as __pageData,d as default};
