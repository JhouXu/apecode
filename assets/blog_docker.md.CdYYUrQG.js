import{m as n,l,c as t,b as e,g as i,k as p,ak as h,j as k}from"./chunks/framework.B-iYIpxV.js";const r="/apecode/assets/2025-04-25_23-18-24_docker.AEgqdv2y.jpg",d="/apecode/assets/2025-04-27_16-09-57_docker.D0QFMuIQ.jpg",o="/apecode/assets/2025-04-27_17-03-39_docker.Bs8Rtk88.jpg",c="/apecode/assets/2025-04-27_18-23-32_docker.B38GjM9Z.jpg",g="/apecode/assets/2025-04-27_20-59-35_docker.D80qvjtY.jpg",E="/apecode/assets/2025-04-27_21-06-06_docker.apUMOfNP.jpg",y="/apecode/assets/2025-04-27_23-14-17_docker.Lqd4Pnni.jpg",F="/apecode/assets/2025-04-28_16-22-52_docker.CDX_L0CI.jpg",u="/apecode/assets/2025-04-28_16-25-04_docker.qAco03pF.jpg",q=JSON.parse('{"title":"Docker 学习笔记","description":"","frontmatter":{"layout":"doc","date":"2025-04-24"},"headers":[],"relativePath":"blog/docker.md","filePath":"blog/docker.md","lastUpdated":1747989598000}'),m={name:"blog/docker.md"};function C(b,s,B,D,v,A){const a=l("PageInfo");return e(),t("div",null,[s[0]||(s[0]=i("h1",{id:"docker-学习笔记",tabindex:"-1"},[k("Docker 学习笔记 "),i("a",{class:"header-anchor",href:"#docker-学习笔记","aria-label":'Permalink to "Docker 学习笔记"'},"​")],-1)),p(a,{readingTime:"12",wordCount:"3.8k",publicTime:"2025-04-24"}),s[1]||(s[1]=h(`<h2 id="初识" tabindex="-1">初识 <a class="header-anchor" href="#初识" aria-label="Permalink to &quot;初识&quot;">​</a></h2><h3 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h3><blockquote><p>在项目生命周期中，我们编写的代码会接触几个环境：开发环境、测试环境和生产环境。当软件跨环境迁移运行时，可能会出现<code>代码水土不服</code>。</p></blockquote><ul><li>Docker 是一个开源的<code>应用容器引擎</code>；</li><li>诞生于 2013 年，基于 <code>Go 语言</code>实现，dotCloud 公司出品（后改名为 Docker Inc.）</li><li>Docker 可以让开发者打包他们的应用以及依赖包到一个<code>轻量级、可移植的</code>容器中，然后发布到任何流行的 Linux 机器上；</li><li>容器时完全使用<code>沙箱机制</code>，且<code>互相隔离</code>；</li><li>容器性能<code>开销极低</code>。</li><li>Docker 从 17.03 版本之后分为 CE(Community Edition: 社区版)和 EE(Enterprise Edition: 企业版)</li></ul><p><code>Docker 是一种容器技术，解决软件跨环境迁移的问题。</code></p><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h3><p>Docker 可以运行在 MAC、Linux、Windows 等操作系统上。（视频教程将于 CentOS 7 进行演示）</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1 yum 包更新到最新</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2 安装需要的软件包</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># yum-util 提供 yum-config-manager 命令，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># device-mapper-persistent-data 和 lvm2 是 devicemapper 驱动依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum-utils</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vice-mapper-persistent-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lvm2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3 设置 yum 源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum-config-manager</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://download.docker.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4 安装 docker，出现输入的界面都按 y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5 查看 docker 版本，验证是否安装成功</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><h3 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to &quot;架构&quot;">​</a></h3><p><img src="`+r+`" alt="docker 架构"></p><ul><li>镜像（Image）： Docker 镜像，相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的 一套 Ubuntu16.04 最小系统的 root 文件系统。</li><li>容器（Container）：镜像和容器的关系，就像是面向对象程序设计中的类和对象一样，镜像是静态的定义，容器时镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</li><li>仓库（Repository）：仓库可以看成是一个代码控制中心，用来保存镜像。</li></ul><h3 id="配置镜像加速" tabindex="-1">配置镜像加速 <a class="header-anchor" href="#配置镜像加速" aria-label="Permalink to &quot;配置镜像加速&quot;">​</a></h3><p>默认情况下：从 <a href="https://hub.docker.com/" target="_blank" rel="noreferrer">Docker Hub</a>上下载 docker 镜像比较慢。一般都会配置镜像加速器。</p><ul><li>USTC 中科大镜像加速器：<a href="https://docker.mirrors.ustc.edu.cn/" target="_blank" rel="noreferrer">https://docker.mirrors.ustc.edu.cn/</a></li><li>阿里云：略。<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noreferrer">查询 👉</a></li><li>网易云：略</li><li>腾讯云：略</li></ul><h2 id="命令" tabindex="-1">命令 <a class="header-anchor" href="#命令" aria-label="Permalink to &quot;命令&quot;">​</a></h2><h3 id="安装相关" tabindex="-1">安装相关 <a class="header-anchor" href="#安装相关" aria-label="Permalink to &quot;安装相关&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">提示</p><p>跳到 <a href="./docker.html#安装">安装</a>。</p></div><h3 id="服务相关" tabindex="-1">服务相关 <a class="header-anchor" href="#服务相关" aria-label="Permalink to &quot;服务相关&quot;">​</a></h3><ul><li><strong>启动</strong></li><li><strong>停止</strong></li><li><strong>重启</strong></li><li><strong>查看状态</strong></li><li><strong>开机启动</strong></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 停止 docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启 docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看 docker 状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开机启动 docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">系统命令</p><ol><li>ubuntu - server</li><li>mac - launchctl</li><li>centos - systemctl</li></ol></div><h3 id="镜像相关" tabindex="-1">镜像相关 <a class="header-anchor" href="#镜像相关" aria-label="Permalink to &quot;镜像相关&quot;">​</a></h3><p><strong>查看镜像</strong>：查看本地所有的镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有镜像id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span></span></code></pre></div><p><strong>搜索镜像</strong>：从网络中查找需要的镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像名]</span></span></code></pre></div><p><strong>拉取镜像</strong>：从 Docker 仓库下载镜像到本地，镜像名称格式为 <code>名称:版本号</code>，如果版本号不指定则是<code>最新的版本（latest）</code>。如果不知道镜像版本，可以去 <code>docker hub</code> 上查看。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拉取镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像名]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 拉取镜像，指定版本号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像名]:[版本号]</span></span></code></pre></div><p><strong>删除镜像</strong>：删除本地镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除指定本地镜像，方式一</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rmi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像名]:[版本号]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除指定本地镜像，方式二</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rmi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像id]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除所有本地镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rmi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> images </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-q</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span></code></pre></div><h3 id="容器相关" tabindex="-1">容器相关 <a class="header-anchor" href="#容器相关" aria-label="Permalink to &quot;容器相关&quot;">​</a></h3><p><strong>查看容器</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看正在运行的容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有容器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># STATUS：镜像状态，UP：正在运行，Exited：已经退出</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><p><strong>创建容器</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [参数]</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">参数说明</p><p><strong>-i</strong>：保持容器运行。同城与 <code>-t</code> 同时使用。加入 it 这两个参数后，容器创建后会自动进入容器中，<code>退出容器后，容器会自动关闭</code>。</p><p><strong>-t</strong>：为容器重新分配一个伪输入终端，通常与 <code>-i</code> 同时使用。</p><p><strong>-d</strong>：以守护（后台）模式运行容器。创建一个容器在后台运行，需要使用 docker exec 进入容器。<code>退出容器后，不会关闭</code>。</p><p><strong>-it</strong> 和 <strong>-id</strong> 的区别： <code>-it</code> 创建的容器一般称为<code>交互式容器</code>， <code>-id</code> 创建的容器一般称为<code>守护式容器</code>。</p><p><strong>--name</strong>：为创建的容器命名。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 示例：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 创建一个 centos 版本为 7 的交互式容器，并命名为 c1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 创建一个 centos 版本为 7 的守护式容器，并命名为 c2</span></span></code></pre></div></div><p><strong>进入和退出容器</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器名] bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 退出容器</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span></code></pre></div><p><strong>停止容器</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器名]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[容器id]</span></span></code></pre></div><p><strong>启动容器</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器名]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[容器id]</span></span></code></pre></div><p><strong>删除容器</strong>：如果容器是运行状态则删除失败，需要停止容器后才能删除。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器名]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[容器id]</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看所有容器的id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除全部容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span></code></pre></div></div><p><strong>查看容器信息</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器名]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[容器id]</span></span></code></pre></div><h2 id="容器的数据卷" tabindex="-1">容器的数据卷 <a class="header-anchor" href="#容器的数据卷" aria-label="Permalink to &quot;容器的数据卷&quot;">​</a></h2><h3 id="数据卷概念及作用" tabindex="-1">数据卷概念及作用 <a class="header-anchor" href="#数据卷概念及作用" aria-label="Permalink to &quot;数据卷概念及作用&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">思考</p><p>Docker 容器删除后，在容器中产生的数据也会随之销毁吗？</p><p>Docker 容器和外部机器可以直接交换文件吗？</p><p>容器之间如何进行数据交互？</p></div><p>数据卷：</p><ul><li>是宿主机中的一个目录或文件。</li><li>当容器目录和数据卷目录绑定后，对方的修改会立即同步。</li><li>一个数据卷可以被多个容器同时挂载。</li><li>一个容器也可以被挂载多个数据卷。</li></ul><p>数据卷作用：</p><ul><li>容器数据持久化。</li><li>外部机器和容器间接通讯。</li><li>容器之间数据交换。</li></ul><p><img src="`+d+`" alt="数据卷示意图"></p><h3 id="配置数据卷" tabindex="-1">配置数据卷 <a class="header-anchor" href="#配置数据卷" aria-label="Permalink to &quot;配置数据卷&quot;">​</a></h3><p>创建启动容器时，使用 -v 参数来配置数据卷。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -[参数]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:[容器名]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像名]:[镜像版本] -v [宿主机目录(文件)]:[容器内目录(文件)]</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意事项</p><ol><li>目录必须是绝对路径。</li><li>如果目录不存在，将会自动创建。</li><li>可以挂载多个数据卷。</li></ol></div><div class="tip custom-block"><p class="custom-block-title">示例</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置一个数据卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data:/root/data</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置多个数据卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data2:/root/data2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data3:/root/data3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 一个数据卷，挂载给不同的容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data:/root/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data:/root/data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data:/root/data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /root/data:/root/data</span></span></code></pre></div></div><h3 id="配置数据卷容器" tabindex="-1">配置数据卷容器 <a class="header-anchor" href="#配置数据卷容器" aria-label="Permalink to &quot;配置数据卷容器&quot;">​</a></h3><p>多容器进行数据交换的方式：</p><ol><li>多个容器挂载同一个数据卷</li><li><code>数据卷容器</code></li></ol><p><img src="`+o+`" alt="数据卷容器卷示意图"></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 创建启动 c3 数据卷容器，使用 -v 参数，设置数据卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /volume</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 创建启动 c1 c2 容器，使用 --volumes-form 参数，设置数据卷</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --volumes-from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> c3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name:c2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> centos:7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --volumes-from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> c3</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">小结</p><ol><li>数据卷概念：宿主机的一个目录或文件。</li><li>数据卷作用： <ul><li>容器数据持久化。</li><li>客户端和容器数据交换。</li><li>容器间数据交换。</li></ul></li><li>数据卷容器： <ul><li>创建一个容器，挂载一个目录，让其他容器继承自该容器（--volumes-from）。</li><li>通过简单方式实现数据卷配置。</li><li><strong>作用</strong>：<code>实现解构，快速复制容器的数据卷配置</code></li></ul></li></ol></div><h2 id="应用部署" tabindex="-1">应用部署 <a class="header-anchor" href="#应用部署" aria-label="Permalink to &quot;应用部署&quot;">​</a></h2><h3 id="mysql" tabindex="-1">mysql <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;mysql&quot;">​</a></h3><blockquote><p>MySQL 是一个开源的关系型数据库管理系统（RDBMS）。简单点说，就是一种用来存储、管理和查询数据的软件。</p></blockquote><p>需求：在 Docker 容器中部署 MySQL，并通过外部 mysql 客户端操作 MySQL Server。</p><p>实现步骤：</p><ol><li>搜索 mysql 镜像</li><li>拉去 mysql 镜像</li><li>创建容器</li><li>操作容器中的 mysql</li></ol><p><a href="https://www.bilibili.com/video/BV1CJ411T7BK/" target="_blank" rel="noreferrer">详细操作实现 👉</a></p><div class="tip custom-block"><p class="custom-block-title">提示</p><p><img src="`+c+'" alt="应用部署 MySQl 容器示意图"></p><ul><li>容器内的网络服务和外部机器不能直接通讯。</li><li>外部机器和宿主机可以直接通讯。</li><li>宿主机和容器可以直接通讯。</li><li>当容器中的网络服务需要被外部机器访问时，可以将容器中提供服务的端口映射到宿主机的端口号上。外部机器访问宿主机的该端口，从而间接访问容器的服务。</li><li>这种操作称为：<code>端口映射</code>。</li></ul></div><h3 id="tomcat" tabindex="-1">tomcat <a class="header-anchor" href="#tomcat" aria-label="Permalink to &quot;tomcat&quot;">​</a></h3><blockquote><p>Tomcat 是一个轻量级的 Web 服务器 + Servlet 容器，主要是用来运行 Java Web 应用的。</p></blockquote><p>略</p><h3 id="nginx" tabindex="-1">nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;nginx&quot;">​</a></h3><blockquote><p>Nginx 是一个高性能的 Web 服务器、反向代理服务器和负载均衡器。</p></blockquote><p>略</p><h3 id="redis" tabindex="-1">redis <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;redis&quot;">​</a></h3><blockquote><p>Redis 是一个开源的、基于内存的、高性能键值（key-value）数据库。</p></blockquote><p>略</p><h2 id="dockerfile" tabindex="-1">Dockerfile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;Dockerfile&quot;">​</a></h2><p><strong>镜像原理</strong></p><div class="warning custom-block"><p class="custom-block-title">思考</p><p>Docker 镜像本质是什么？</p><p>Docker 中一个 centos 镜像为什么只有 200MB，而一个 centos 操作系统的 iso 文件有几个 G?</p><p>Docker 中一个 tomcat 镜像为什么有 500MB，而一个 tomcat 安装包只有 70 多 MB?</p></div><p>操作系统组成部分：</p><ul><li>进程调度子系统</li><li>进程通讯子系统</li><li>内存管理子系统</li><li>设备管理子系统</li><li><code>文件管理子系统</code></li><li>网络通讯子系统</li><li>作业控制子系统</li></ul><p>Linux 文件系统由 bootfs 和 rootfs 两部分组成：</p><ul><li>bootfs：包含 bootloader（引导加载程序）和 kernel（内核）。</li><li>rootfs：root 文件系统，包含的就是典型 Linux 系统中的/dev，/proc，/bin，/etc 等标准目录和文件。</li><li>不同的 linux 发行版，bootfs 基本一样，而 rootfs 不同，如 ubuntu、centos 等。</li></ul><p><img src="'+g+'" alt="文件系统示意图"></p><h3 id="docker-镜像" tabindex="-1">Docker 镜像 <a class="header-anchor" href="#docker-镜像" aria-label="Permalink to &quot;Docker 镜像&quot;">​</a></h3><ul><li>Docker 镜像是由特殊的文件系统叠加而成。</li><li>最底端是 bootfs，并使用过宿主机的 bootfs。</li><li>第二层是 root 文件系统 rootfs，称为 base image。</li><li>然后再往上可以叠加其他的镜像文件。</li><li>统一文件系统（Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供了一个统一的视角，这样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统。</li><li>一个镜像可以放在另一个镜像的上面，位于下面的镜像称为父镜像，最底部的镜像称为基础镜像。</li><li>当从一个镜像启动容器时，Docker 会在最顶层加载一个读写文件系统作为容器。</li></ul><p><img src="'+E+`" alt="文件系统示意图"></p><div class="tip custom-block"><p class="custom-block-title">思考答案</p><p>Docker 镜像本质是什么？</p><ul><li>是一个分层文件系统。</li></ul><p>Docker 中一个 centos 镜像为什么只有 200MB，而一个 centos 操作系统的 iso 文件有几个 G?</p><ul><li>Centos 的 iso 镜像文件包含 bootfs 和 rootfs，而 docker 的 centos 镜像复用操作系统的 bootfs，只有 rootfs 和其他镜像层。</li></ul><p>Docker 中一个 tomcat 镜像为什么有 500MB，而一个 tomcat 安装包只有 70 多 MB?</p><ul><li>鱿鱼 docker 中镜像是分层的，tomcat 虽然只有 70 多 MB，但他需要依赖于父镜像和基础镜像，所以整个对外暴露的 tomcat 镜像大小有 500MB。</li></ul></div><h3 id="docker-镜像制作" tabindex="-1">Docker 镜像制作 <a class="header-anchor" href="#docker-镜像制作" aria-label="Permalink to &quot;Docker 镜像制作&quot;">​</a></h3><p><strong>1. 容器转为镜像</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 容器转为镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [容器id] [镜像名称]:[版本号]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 镜像转为压缩文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> save</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [压缩文件名称] [镜像名称]:[版本号]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 压缩文件转为镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> load</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [压缩文件名称]</span></span></code></pre></div><p><img src="`+y+`" alt="容器转镜像示意图"></p><p><strong>2. Dockerfile</strong></p><p>Dockerfile 概念：</p><ul><li>Dockerfile 是一个文本文件。</li><li>包含了一条条的指令。</li><li>每一条指令构建一层，基于基础镜像，最终构建出一个新的镜像。</li><li>对于开发人员：可以为开发团队提供一个完全一致的开发环境。</li><li>对于测试人员：可以直接拿开发时所构建的镜像或者通过 Dockerfile 文件，构建一个新的镜像，从而开展测试工作。</li><li>对于运维人员：在部署时，可以实现应用的无缝移植。</li></ul><details class="details custom-block"><summary>Dockerfile 示例</summary><p><a href="https://github.com/nodejs/docker-node/blob/f6908ff3eb35a5d0c8fc60086fd29ae16e3abdba/23/alpine3.20/Dockerfile" target="_blank" rel="noreferrer">docker-node/23/alpine3.20/Dockerfile 👉</a></p><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> alpine:3.20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_VERSION 23.11.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addgroup -g 1000 node \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; adduser -u 1000 -G node -s /bin/sh -D node \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk add --no-cache \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        libstdc++ \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk add --no-cache --virtual .build-deps \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        curl \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; ARCH= OPENSSL_ARCH=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;linux*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; alpineArch=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(apk --print-arch)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &amp;&amp; case </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${alpineArch##*-}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> in \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x86_64) ARCH=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x64&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHECKSUM=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;d267e68a33036c2f3803adaf79b7191bcf45219cc12246f61c48b891bb70e943&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENSSL_ARCH=linux-x86_64;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x86) OPENSSL_ARCH=linux-elf;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        aarch64) OPENSSL_ARCH=linux-aarch64;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        arm*) OPENSSL_ARCH=linux-armv4;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ppc64le) OPENSSL_ARCH=linux-ppc64le;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        s390x) OPENSSL_ARCH=linux-s390x;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        *) ;; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      esac \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; if [ -n </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${CHECKSUM}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; then \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    set -eu; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    curl -fsSLO --compressed </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://unofficial-builds.nodejs.org/download/release/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH-musl.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$CHECKSUM  node-v$NODE_VERSION-linux-$ARCH-musl.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | sha256sum -c - \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &amp;&amp; tar -xJf </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION-linux-$ARCH-musl.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -C /usr/local --strip-components=1 --no-same-owner \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  else \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Building from source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # backup build</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk add --no-cache --virtual .build-deps-full \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        binutils-gold \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        g++ \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        gcc \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        gnupg \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        libgcc \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        linux-headers \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        make \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        python3 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        py-setuptools \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # use pre-existing gpg directory, see https://github.com/nodejs/docker-node/pull/1895#issuecomment-1550389150</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; export GNUPGHOME=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(mktemp -d)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # gpg keys listed at https://github.com/nodejs/node#release-keys</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; for key in \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      C0D6248439F1D5604AAFFB4021D900FFDB233756 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      DD792F5973C6DE52C432CBDAC77ABFA00DDBF2B7 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      CC68F5A3106FF448322E48ED27F5E38D5B0A215F \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      8FCCA13FEF1D0C2E91008E09770F7A9A5AE15600 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      890C08DB8579162FEE0DF9DB8BEAB4DFCF555EF4 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      C82FA3AE1CBEDC6BE46B9360C43CEC45C17AB93C \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      108F52B48DB57BB0CC439B2997B01419BD92F80A \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      A363A499291CBBC940DD62E41F10027AF002F8B0 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ; do \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> || \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      gpg --batch --keyserver keyserver.ubuntu.com --recv-keys </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    done \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; curl -fsSLO --compressed </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; curl -fsSLO --compressed </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; gpgconf --kill all \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; rm -rf </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$GNUPGHOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; grep </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; node-v$NODE_VERSION.tar.xz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SHASUMS256.txt | sha256sum -c - \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; tar -xf </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; cd </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; ./configure \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; make -j$(getconf _NPROCESSORS_ONLN) V= \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; make install \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk del .build-deps-full \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; cd .. \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; rm -Rf </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; rm </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SHASUMS256.txt.asc SHASUMS256.txt; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fi \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; rm -f </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-v$NODE_VERSION-linux-$ARCH-musl.tar.xz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Remove unused OpenSSL headers to save ~34MB. See this NodeJS issue: https://github.com/nodejs/node/issues/46451</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; find /usr/local/include/node/openssl/archs -mindepth 1 -maxdepth 1 ! -name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$OPENSSL_ARCH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -exec rm -rf {} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; apk del .build-deps \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # smoke tests</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; node --version \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; npm --version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> YARN_VERSION 1.22.22</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apk add --no-cache --virtual .build-deps-yarn curl gnupg tar \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # use pre-existing gpg directory, see https://github.com/nodejs/docker-node/pull/1895#issuecomment-1550389150</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; export GNUPGHOME=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(mktemp -d)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; for key in \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    6A010C5166006599AA17F08146C2130DFD2497F5 \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ; do \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gpg --batch --keyserver hkps://keys.openpgp.org --recv-keys </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> || \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    gpg --batch --keyserver keyserver.ubuntu.com --recv-keys </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  done \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; curl -fsSLO --compressed </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; curl -fsSLO --compressed </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz.asc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; gpg --batch --verify yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; gpgconf --kill all \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; rm -rf </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$GNUPGHOME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; mkdir -p /opt \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; tar -xzf yarn-v$YARN_VERSION.tar.gz -C /opt/ \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; ln -s /opt/yarn-v$YARN_VERSION/bin/yarn /usr/local/bin/yarn \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; ln -s /opt/yarn-v$YARN_VERSION/bin/yarnpkg /usr/local/bin/yarnpkg \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; rm yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; apk del .build-deps-yarn \\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # smoke test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; yarn --version \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &amp;&amp; rm -rf /tmp/*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker-entrypoint.sh /usr/local/bin/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-entrypoint.sh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]</span></span></code></pre></div></details><p><strong>Dockerfile 关键字</strong>：</p><table tabindex="0"><thead><tr><th style="text-align:center;">关键字</th><th style="text-align:center;">作用</th><th style="text-align:center;">备注</th></tr></thead><tbody><tr><td style="text-align:center;">FROM</td><td style="text-align:center;">指定父镜像</td><td style="text-align:center;">指定 dockerfile 基于那个 image 构建。</td></tr><tr><td style="text-align:center;">MAINTAINER</td><td style="text-align:center;">作者信息</td><td style="text-align:center;">用来标明这个 dockerfile 谁写的。</td></tr><tr><td style="text-align:center;">LABEL</td><td style="text-align:center;">标签</td><td style="text-align:center;">用来标明 dockerfile 的标签，可以使用 Label 代香 Maintainer 最终都是在 docker image 基本信息中可以查看。</td></tr><tr><td style="text-align:center;">RUN</td><td style="text-align:center;">执行命令</td><td style="text-align:center;">执行一段命令默认是/bin/sh 格式:RUN command 或者 RUN [&quot;command&quot;, &quot;param1&quot;,&quot;param2&quot;]。</td></tr><tr><td style="text-align:center;">CMD</td><td style="text-align:center;">容器启动命令</td><td style="text-align:center;">提供启动容器时候的默认命令，和 ENTRYPOINT 配合使用.格式 CMD command param1 param2 或者 CMD [&quot;command&quot;,&quot;paramr&quot;,&quot;param2&quot;]。</td></tr><tr><td style="text-align:center;">ENTRYPOINT</td><td style="text-align:center;">入口</td><td style="text-align:center;">一般在制作一些执行就关闭的容器中会使用。</td></tr><tr><td style="text-align:center;">COPY</td><td style="text-align:center;">复制文件</td><td style="text-align:center;">build 的时候复制文件到 image 中。</td></tr><tr><td style="text-align:center;">ADD</td><td style="text-align:center;">添加文件</td><td style="text-align:center;">build 的时候添加文件到 image 中，不仅仅局限于当前 build 上下文可以来源于远程服务。</td></tr><tr><td style="text-align:center;">ENV</td><td style="text-align:center;">环境变量</td><td style="text-align:center;">指定 build 时候的环境变量，可以在启动的容器的时候通过-e 覆盖格式 ENV name=value。</td></tr><tr><td style="text-align:center;">ARG</td><td style="text-align:center;">构建参数</td><td style="text-align:center;">构建参数只在构建的时候使用的参数如果有 ENV，那么 ENV 的相同名字的值始终覆盖 arg 的参数。</td></tr><tr><td style="text-align:center;">VOLUME</td><td style="text-align:center;">定义外部可以挂载的数据卷</td><td style="text-align:center;">指定 build 的 image 那些目录可以启动的时候挂载到文件系统中，启动容器的时候使用-V 绑定格式 VOLUME[&quot;目录&quot;]。</td></tr><tr><td style="text-align:center;">EXPOSE</td><td style="text-align:center;">暴露端口</td><td style="text-align:center;">定义容器运行的时候监听的端口启动容器的使用-p 来绑定暴露端口，格式：EXPOSE 8080 或者 EXPOSE 8080/udp。</td></tr><tr><td style="text-align:center;">WORKDIR</td><td style="text-align:center;">工作目录</td><td style="text-align:center;">指定容器内部的工作目录，如果没有创建则自动创建，如果指定/使用的是绝对地址，如果不是/开头那么是在上一条 workdir 的路径的相对路径。</td></tr><tr><td style="text-align:center;">USER</td><td style="text-align:center;">指定执行用户</td><td style="text-align:center;">指定 build 或者启动的时候用户在 RUN CMD ENTRYPONT 执行的时候的用户。</td></tr><tr><td style="text-align:center;">HEALTHCHECK</td><td style="text-align:center;">健康检查</td><td style="text-align:center;">指定监测当前容器的健康监测的命令，基本上没用因为很多时候，应用本身有健康监测机制。</td></tr><tr><td style="text-align:center;">ONBUILD</td><td style="text-align:center;">触发器</td><td style="text-align:center;">当存在 ONBUILD 关键字的镜像作为基础镜像的时候，当执行 FROM 完成之后，会执行 ONBUILD 的命令，但是不影响当前镜像，用处也不怎么大。</td></tr><tr><td style="text-align:center;">STOPSIGNAL</td><td style="text-align:center;">发送信号量到宿主机</td><td style="text-align:center;">该 STOPSIGNAL 指令设置将发送到容器的系统调用信号以退出。</td></tr><tr><td style="text-align:center;">SHELL</td><td style="text-align:center;">指定执行脚本的 shell</td><td style="text-align:center;">指定 RUN CMD ENTRYPOINT 执行命令的时候使用的 shell。</td></tr></tbody></table><h3 id="案例" tabindex="-1">案例 <a class="header-anchor" href="#案例" aria-label="Permalink to &quot;案例&quot;">​</a></h3><h4 id="自定义-centos" tabindex="-1">自定义 centos <a class="header-anchor" href="#自定义-centos" aria-label="Permalink to &quot;自定义 centos&quot;">​</a></h4><p>略</p><h4 id="部署-spring-boot-项目" tabindex="-1">部署 spring boot 项目 <a class="header-anchor" href="#部署-spring-boot-项目" aria-label="Permalink to &quot;部署 spring boot 项目&quot;">​</a></h4><p>略</p><h2 id="服务编排" tabindex="-1">服务编排 <a class="header-anchor" href="#服务编排" aria-label="Permalink to &quot;服务编排&quot;">​</a></h2><blockquote><p>微服务架构的应用系统中一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，维护的工作量会很大。</p><ul><li>要从 Dockerfile build image 或者去 dockerhub 拉去 image</li><li>要创建多个 container</li><li>要管理这些 container（启动停止删除）</li></ul></blockquote><p><code>服务编排</code>：按照一当的业务规则批量管理容器。</p><p>Docker Compose 是一个编排多容器分布式部署的工具，提供命令集管理容器化应用的完整开发周期，包括服务构建，启动和停止。使用步骤：</p><ol><li>利用 Dockerfile 定义运行环境镜像。</li><li>使用 docker-compose.yml 定义组成应用的各服务。</li><li>运行 docker-compose up 启动容器。</li></ol><h3 id="命令-1" tabindex="-1">命令 <a class="header-anchor" href="#命令-1" aria-label="Permalink to &quot;命令&quot;">​</a></h3><p>安装相关</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Compose 目前已经完全支持 Linux、macOS、Windows，在安装 Compose 之前，需要先安装 Docker。下面我们以编译好的二进制包方式安装在 Linux 系统为例。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/docker/compose/releases/download/1.22.0/docker-compose-\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/docker-compose</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置文件可执行权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/docker-compose</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看版本信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -version</span></span></code></pre></div><p>卸载相关</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 二进制包方式安装的，删除二进制文件即可</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/docker-compose</span></span></code></pre></div><h3 id="使用-docker-compose-编排-nginx-spring-boot-项目" tabindex="-1">使用 Docker Compose 编排 nginx + spring boot 项目 <a class="header-anchor" href="#使用-docker-compose-编排-nginx-spring-boot-项目" aria-label="Permalink to &quot;使用 Docker Compose 编排 nginx + spring boot 项目&quot;">​</a></h3><p>略</p><h2 id="私有仓库" tabindex="-1">私有仓库 <a class="header-anchor" href="#私有仓库" aria-label="Permalink to &quot;私有仓库&quot;">​</a></h2><p>Docker 官方的 Docker Hub （<a href="https://hub.docker.com" target="_blank" rel="noreferrer">https://hub.docker.com</a>）是一个用于管理公共镜像的仓库，我们可以从上面拉去镜像到本地，也可以把我们自己的镜像推送上去。但是，有时候我们的服务器无法访问互联网，或者你不希望将自己的镜像放到公网当中，那么我们就需要搭建自己的私有仓库来存储和管理自己的镜像。</p><h3 id="搭建" tabindex="-1">搭建 <a class="header-anchor" href="#搭建" aria-label="Permalink to &quot;搭建&quot;">​</a></h3><p>私有仓库搭建</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1 拉去私有仓库镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2 启动私有仓库容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5000:5000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3 打开浏览器 访问 http://[私有仓库服务器ip]:5000/v2/_catalog，可以看到 {&quot;repositories&quot;:[]} 表示私有仓库搭建成功。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4 修改 daemon.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/docker/daemon.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在上述文件中添加一个 key，并保存退出。此步骤用于让 docker 信任私有仓库地址；注意将私有仓库服务器 ip 修改为自己私有仓库服务器的真实 ip。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;insecure-registries&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;[私有仓库服务器ip]:5000&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5 重启 docker 服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry</span></span></code></pre></div><h3 id="上传" tabindex="-1">上传 <a class="header-anchor" href="#上传" aria-label="Permalink to &quot;上传&quot;">​</a></h3><p>将镜像上传至私有仓库</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1 标记镜像为私有仓库的镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [镜像id] [私有仓库服务器ip]:5000/[镜像名称]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 例如 docker tag centos:7 [私有仓库服务器ip]:5000/centos:7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2 上传标记的镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [私有仓库服务器ip]:5000/[镜像名称]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 例如 docker push [私有仓库服务器ip]:5000/centos:7</span></span></code></pre></div><h3 id="拉取" tabindex="-1">拉取 <a class="header-anchor" href="#拉取" aria-label="Permalink to &quot;拉取&quot;">​</a></h3><p>从私有仓库拉取镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [私有仓库服务器ip]:5000/[镜像名称]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 例如 docker pull [私有仓库服务器ip]:5000/centos:7</span></span></code></pre></div><h2 id="相关概念" tabindex="-1">相关概念 <a class="header-anchor" href="#相关概念" aria-label="Permalink to &quot;相关概念&quot;">​</a></h2><p>容器就是将软件打包成标准化单元，以用于开发、交付和部署。</p><ul><li>容器镜像是轻量的，可执行的独立软件包，包含软件运行所需的所有内容：代码、运行时环境、系统工具、系统库和设置。</li><li>容器化软件在任何环境中都能够始终如一地运行。</li><li>容器赋予了软件独立性，使其免受外在环境差异的影响，从而有助于减少团队间在相同基础设施上运行不同软件时的冲突。</li></ul><p><img src="`+F+'" alt="容器架构示意图"></p><h3 id="docker-容器虚拟化与-传统虚拟机-比较" tabindex="-1"><code>docker 容器虚拟化</code>与 <code>传统虚拟机</code> 比较 <a class="header-anchor" href="#docker-容器虚拟化与-传统虚拟机-比较" aria-label="Permalink to &quot;`docker 容器虚拟化`与 `传统虚拟机` 比较&quot;">​</a></h3><p>相同：</p><ul><li>容器和虚拟机具有相似的资源隔离和分配优势。</li></ul><p>不同：</p><ul><li>容器虚拟化的是操作系统，虚拟机虚拟化的是硬件。</li><li>传统虚拟机可以运行不同的操作系统，容器只能运行同一类操作系统。</li></ul><table tabindex="0"><thead><tr><th style="text-align:center;">特性</th><th style="text-align:center;">容器</th><th style="text-align:center;">虚拟机</th></tr></thead><tbody><tr><td style="text-align:center;">启动</td><td style="text-align:center;">秒级</td><td style="text-align:center;">分钟级</td></tr><tr><td style="text-align:center;">硬盘使用</td><td style="text-align:center;">一般为 MB</td><td style="text-align:center;">一般为 GB</td></tr><tr><td style="text-align:center;">性能</td><td style="text-align:center;">接近原生</td><td style="text-align:center;">弱于</td></tr><tr><td style="text-align:center;">系统支持量</td><td style="text-align:center;">单机支持上千个容器</td><td style="text-align:center;">一般几十个</td></tr></tbody></table><p><img src="'+u+'" alt="容器架构和虚拟机架构示意图"></p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://www.docker.com/" target="_blank" rel="noreferrer">Docker 官方文档 👉</a></li><li><a href="https://www.bilibili.com/video/BV1CJ411T7BK/" target="_blank" rel="noreferrer">黑马程序员 Docker 容器化技术，从零学会 Docker 教程 - 黑马程序员 👉</a></li></ul>',146))])}const f=n(m,[["render",C]]);export{q as __pageData,f as default};
